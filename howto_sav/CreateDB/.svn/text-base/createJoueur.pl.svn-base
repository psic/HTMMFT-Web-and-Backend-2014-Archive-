#!/usr/bin/perl -w
use strict;
use warnings;
use DBI;

#Ce script génére les joueurs pour toute les equipe (16x8) avec les contrat associé, ainsi que des joueurs dans contrat

my $database="howto";
#my $hostname="88.167.71.144";
#my $hostname="192.168.30.15";
my $hostname="127.0.0.1";
#my $login = "football";
#my $mdp = "!M4n4g3r";

my $login = "root";
my $mdp = "cacapipi";


my $dsn = "DBI:mysql:database=$database;host=$hostname";
my $dbh = DBI->connect($dsn, $login, $mdp) or die "Echec connexion";
my @contenu;

open(NAME, "name.txt") || die "Erreur E/S : $!\n";
@contenu = <NAME>;
my @name;
foreach (@contenu) {
    push(@name, split(/ /, $_));   
   }

close (NAME);

open(FIRSTNAME, "name.txt") || die "Erreur E/S : $!\n";
@contenu = <FIRSTNAME>;
my @firstname;
foreach (@contenu) {
    push(@firstname, split(/ /, $_));   
   }

close (FIRSTNAME);

#my $fini = FALSE;
my $nbteam = 1;
my $nbjoueur = 1;
my $nbligue = 1;

#while ($fini)
#{
#  $requete = "SELECT * FROM laTable ";
#  $sth = $dbh->prepare($requete);
#  $sth->execute();
  
#  while($nbligue =< 4)
#  {
#    while($nbteam =< 16)
#    {
  my $requete;
  my $sth;


  my $contratID;
  my $joueurID;
  my $equipeID;
  my $nbequipe;
  my $nom;
  my $prenom;
  my $age; 
  my $xp;
  my $talent;
  my $tactique;
  my $technique;
  my $physique;
  my $vitesse;
  my $mental;
#  my totalEquipe = 7700;
  my $total = 0;
  my $totalEquipe = 0;
  my $off;
  my $def;
  my $dr;
  my $gch;
  my $ctr;
  my $xppos;
  my $dureeContrat;
  my $moisFin;
  my $salaire;

  my $agemoy = 0; 
  my $xpmoy = 0;
  my $talentmoy = 0;
  my $tactiquemoy = 0;
  my $techniquemoy = 0;
  my $physiquemoy = 0;
  my $vitessemoy = 0;
  my $mentalmoy = 0;
 
  $nbequipe = 0;
  $joueurID = 0;
  $contratID = 0;
  $equipeID = 0;
   
  my $requeteJoueur;
  my $requeteContrat;
  my $sthContrat;
  my $sthJoueur;

	$requeteJoueur = "INSERT INTO joueurs (nom, prenom, age, xp, talent, tactique, technique, physique, vitesse, mental, off, def,drt,ctr, gch, liste_transfert,liste_pret)
	VALUES (?, ?,?,?,?,?,?,?,?,?,?,?,?,?,?,0,0); ";
	$sthJoueur = $dbh->prepare($requeteJoueur);

	$requeteContrat = " INSERT INTO contrats (anne_debut,mois_debut, duree, anne_fin, mois_fin, salaire, equipe_id, joueur_id) 
	VALUES (0,0,?, ?, ?, ?, ?, ?);";	
	$sthContrat = $dbh->prepare($requeteContrat);


   while($nbequipe < (8*16)+1) 
    {
	

      while($totalEquipe <= 7000)
      {
	print "Joueur : $nbjoueur / $joueurID \n";
	$prenom = $firstname[int(rand(scalar @firstname))];
	$nom = $name[int(rand(scalar @name))];
	$age = 15 + int(rand(20));
	$xp = ($age -14) + int(rand($age ** 2)/12.5);
	$talent = int(rand(99) + 1);
	$tactique = int(rand(95) + 5);
	$technique = int(rand(95) + 5);
	$physique = int(rand(97) + 3);
	$vitesse = int(rand(94 - $age) - $age + 36);
	$talent =  int(rand(99) + 1);
	$mental = int(rand(98) + 2);

	$agemoy = $agemoy + $age; 
	$xpmoy = $xpmoy + $xp;
	$talentmoy = $talentmoy +$talent;
	$tactiquemoy = $tactiquemoy + $tactique;
	$techniquemoy = $techniquemoy + $technique;
	$physiquemoy = $physiquemoy + $physique;
	$vitessemoy = $vitessemoy + $vitesse;
	$mentalmoy = $mentalmoy + $mental;	
	
	$total = $talent + $tactique + $technique + $physique + $vitesse + $talent + $mental;
	$totalEquipe = $totalEquipe + $total;
      
	$xppos = int(50 + (rand($xp ** 2)/ $xp));


#Gardien
	if ($nbjoueur <= 3){
	  $dr = 0;
	  $gch = 0;
	  $ctr = 100;
	  $off = 0;
	  $def = $xppos;
	}
	
#Def
	if ($nbjoueur >3 && $nbjoueur <= 10){
	  $dr = int(rand($xppos));
	  $gch = int(rand(100 - $dr))+2;
	  $ctr = int(rand(200-$dr-$gch)/2)+2;
	  $def = 30 + int(rand(20) + ($xppos/2));
	  $off = int(rand(100-$def));
	}

#Milieu
	if ($nbjoueur >10 && $nbjoueur <= 17){
	  $dr = int(rand($xppos));
	  $gch = int(rand(100 - $dr))+2;
	  $ctr = int(rand(200-$dr-$gch)/2)+2;
	  $def = 10 + int(rand(30) + ($xppos/2));
	  $off = 10 + int(rand(30) + ($xppos/2));
	}

#Attaquant
       if ($nbjoueur > 17){
	  $dr = int(rand($xppos));
	  $gch = int(rand(100 - $dr))+2;
	  $ctr = int(rand(200-$dr-$gch)/2);
	  $off = 30 + int(rand(20) + ($xppos/2));
	  $def = int(rand(100-$off))+2;
      }
   
  if ($xp > 100){
    $xp = 100;
  }
  if ($talent > 100){
    $talent = 100;
  }
  if ($tactique > 100){
    $tactique = 100;
  }
  if ($technique > 100){
    $technique = 100;
  }
  if ($physique > 100){
    $physique = 100;
  }
  if ($vitesse > 100){
    $vitesse = 100;
  }
  if ($mental > 100){
    $mental = 100;
  }
  if ($off > 100){
    $off = 100;
  }
  if ($def > 100){
    $def = 100;
  }
  if ($dr > 100){
    $dr = 100;
  }
  if ($gch > 100){
    $gch = 100;
  }
  if ($ctr > 100){
    $ctr = 100;
  }
  
	print "Nom : $prenom $nom, $age ans \n";
	print "xp : $xp \n";
	print "$dr / $ctr / $gch \n";
	print "$def / $off \n";
	print "talent : $talent \n";
	print "tactique : $tactique \n";
	print "technique : $technique \n";
	print "physique : $physique \n";
	print "vitesse : $vitesse \n";
	print "mental : $mental \n";
	print "Total : $total / $totalEquipe \n";
	
	print "----------------------------------------------------- \n";
	#$requeteJoueur = "INSERT INTO Joueurs (Nom, Prenom, Age, Xp, Talent, Tactique, Technique, Physique, Vitesse, Mental, Off, Def,Drt,Ctr, Gch, Liste_Transfert,Liste_Pret)
	#VALUES ('$nom', '$prenom',$age,$xp,$talent,$tactique,$technique,$physique,$vitesse,$mental,$off,$def,$dr,$ctr,$gch,0,0); ";
	#$sthJoueur = $dbh->prepare($requeteJoueur);
	$sthJoueur->execute($nom, $prenom,$age,$xp,$talent,$tactique,$technique,$physique,$vitesse,$mental,$off,$def,$dr,$ctr,$gch);

  
	$dureeContrat = int(rand(4))+1;
	$moisFin = int(rand(11))+1;
	$salaire = int( ($xppos + $xp*2 + $talent*3 + $tactique + $technique + $physique + $vitesse + $mental*2 + $dureeContrat *100 )/($dureeContrat + 12) )*10; 
	
	#$requeteContrat = " INSERT INTO Contrat (Anne_debut,Mois_debut, Duree, Anne_fin, Mois_fin, Salaire, Equipe_ID, Contractant_ID) 
	#VALUES (0,0,$dureeContrat, $dureeContrat, $moisFin, $salaire, $equipeID, $joueurID);";
	
	#$sthContrat = $dbh->prepare($requeteContrat);
	$sthContrat->execute($dureeContrat, $dureeContrat, $moisFin, $salaire, $equipeID, $joueurID);

	$nbjoueur = $nbjoueur +1;
	$joueurID = $joueurID + 1;
	$contratID = $contratID + 1;
  } 
	
	$agemoy = int($agemoy / ($nbjoueur -1)); 
	$xpmoy = int($xpmoy / ($nbjoueur -1));
	$talentmoy = int($talentmoy / ($nbjoueur -1));
	$tactiquemoy = int($tactiquemoy / ($nbjoueur -1));
	$techniquemoy = int($techniquemoy / ($nbjoueur -1));
	$physiquemoy = int($physiquemoy / ($nbjoueur -1));
	$vitessemoy = int($vitessemoy / ($nbjoueur -1));
	$mentalmoy = int($mentalmoy / ($nbjoueur -1));	
	
      print "Total Equipe : $totalEquipe \n";
      print "moyenne : \n";
      print "age : $agemoy \n";
      print "xp : $xpmoy \n";
      print "talent : $talentmoy \n";
      print "tactique : $tactiquemoy \n";
      print "technique : $techniquemoy \n";
      print "physique : $physiquemoy \n";
      print "vitesse : $vitessemoy \n";
      print "mental : $mentalmoy \n";
#      $nbteam = $nbteam + 1;
#      $nbjoueur = 1;
 #   }
#   $nbligue = $nbligue + 1; 
  #}
 # }
  $nbequipe = $nbequipe + 1;
  $equipeID = $equipeID + 1;
  $totalEquipe = 0;
  $nbjoueur = 1;
  $agemoy = 0;
  $xpmoy = 0;
  $talentmoy = 0;
  $tactiquemoy = 0;
  $techniquemoy = 0;
  $physiquemoy = 0;
  $vitessemoy = 0;
  $total = 0;
}



# Joueur sans contrat

my $nbjoueurSC = 0;
$nbjoueur = 1;

print "\n *************************************\n Joueur SANS CONTRAT \n ****************************** \n";

  while($nbjoueurSC <= 500)
      {
	print "Joueur : $nbjoueurSC / $joueurID \n";
	$prenom = $firstname[int(rand(scalar @firstname))];
	$nom = $name[int(rand(scalar @name))];
	$age = 15 + int(rand(20));
	$xp = ($age -14) + int(rand($age ** 2)/12.5);
	$talent = int(rand(99) + 1);
	$tactique = int(rand(95) + 5);
	$technique = int(rand(95) + 5);
	$physique = int(rand(97) + 3);
	$vitesse = int(rand(94 - $age) - $age + 36);
	$talent =  int(rand(99) + 1);
	$mental = int(rand(98) + 2);
	
	$total = $talent + $tactique + $technique + $physique + $vitesse + $talent + $mental;
      
	$xppos = int(50 + (rand($xp ** 2)/ $xp));


#Gardien
	if ($nbjoueur <= 3){
	  $dr = 0;
	  $gch = 0;
	  $ctr = 100;
	  $off = 0;
	  $def = $xppos;
	}
	
#Def
	if ($nbjoueur >3 && $nbjoueur <= 10){
	  $dr = int(rand($xppos));
	  $gch = int(rand(100 - $dr))+2;
	  $ctr = int(rand(200-$dr-$gch)/2)+2;
	  $def = 30 + int(rand(20) + ($xppos/2));
	  $off = int(rand(100-$def));
	}

#Milieu
	if ($nbjoueur >10 && $nbjoueur <= 17){
	  $dr = int(rand($xppos));
	  $gch = int(rand(100 - $dr))+2;
	  $ctr = int(rand(200-$dr-$gch)/2)+2;
	  $def = 10 + int(rand(30) + ($xppos/2));
	  $off = 10 + int(rand(30) + ($xppos/2));
	}

#Attaquant
       if ($nbjoueur > 17){
	  $dr = int(rand($xppos));
	  $gch = int(rand(100 - $dr))+2;
	  $ctr = int(rand(200-$dr-$gch)/2);
	  $off = 30 + int(rand(20) + ($xppos/2));
	  $def = int(rand(100-$off))+2;
      }
   
    if ($nbjoueur > 22)
    {
      $nbjoueur = 0;
    }

  if ($xp > 100){
    $xp = 100;
  }
  if ($talent > 100){
    $talent = 100;
  }
  if ($tactique > 100){
    $tactique = 100;
  }
  if ($technique > 100){
    $technique = 100;
  }
  if ($physique > 100){
    $physique = 100;
  }
  if ($vitesse > 100){
    $vitesse = 100;
  }
  if ($mental > 100){
    $mental = 100;
  }
  if ($off > 100){
    $off = 100;
  }
  if ($def > 100){
    $def = 100;
  }
  if ($dr > 100){
    $dr = 100;
  }
  if ($gch > 100){
    $gch = 100;
  }
  if ($ctr > 100){
    $ctr = 100;
  }
  
	print "Nom : $prenom $nom, $age ans \n";
	print "xp : $xp \n";
	print "$dr / $ctr / $gch \n";
	print "$def / $off \n";
	print "talent : $talent \n";
	print "tactique : $tactique \n";
	print "technique : $technique \n";
	print "physique : $physique \n";
	print "vitesse : $vitesse \n";
	print "mental : $mental \n";
	print "Total : $total \n";
	
	print "----------------------------------------------------- \n";
	#$requeteJoueur = "INSERT INTO Joueur (Nom, Prenom, Age, Xp, Talent, Tactique, Technique, Physique, Vitesse, Mental, Off, Def,Drt,Ctr, Gch, Liste_Transfert,Liste_Pret)
	#VALUES ('$nom', '$prenom',$age,$xp,$talent,$tactique,$technique,$physique,$vitesse,$mental,$off,$def,$dr,$ctr,$gch,0,0); ";
	#$sthJoueur = $dbh->prepare($requeteJoueur);
	$sthJoueur->execute($nom, $prenom,$age,$xp,$talent,$tactique,$technique,$physique,$vitesse,$mental,$off,$def,$dr,$ctr,$gch);

	$nbjoueurSC = $nbjoueurSC +1;
	$joueurID = $joueurID + 1;
	$nbjoueur = $nbjoueur +1;
  } 
	
